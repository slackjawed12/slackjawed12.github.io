---
layout: single

title: "[WIL] 실전 프로젝트 마지막 주차 회고 - 성능 개선"
categories: til99
tag: [WIL]
[//]: # ( 태그 여러개 달고 싶으면 [태그1, 태그2, 태그3 ... ] 으로 작성)
toc : true # table of contents 추가
use_math: true # 수식 쓸 경우 추가
author_profile: true # 포스트 화면에서 작성자 프로필이 나타날지 여부 결정

sidebar:
 nav : "docs"

[//]: # (# search : false # 검색 시 결과에 나타날지 여부 결정)
---

## 1. 5/7 ~ 5/13 회고

&nbsp; &nbsp; 마지막 주차의 주제는 성능 개선이다. JMeter로 부하테스트를 모든 api에 적용해보고, 가장 병목이 심한 api를 찾아 개선의 우선순위를 설정했다.

## 2. JMeter 부하 테스트
&nbsp; &nbsp; Mac은 JMeter 설치하고 실행하는 것부터 난관이었다. brew로 jmeter를 설치하는 것까지는 괜찮았다. 이후 블로그에서 알려주는 대로 open /usr/local/bin/jmeter 명령어를 수행했는데 jmeter가 없었다. 알고보니 애플칩 이후부터는 경로가 open /opt/homebrew/bin/Jmeter로 바뀌었다. 어쨌든 이렇게 jmeter를 실행할 수 있었다.  
&nbsp; &nbsp; 이후 테스트 시나리오를 추가해서 여러 api에 대해 테스트를 수행했는데, 시간 문제 상 과학실험 하듯이 팀원끼리 역할을 나눠야 했다. jmeter를 직접 작동하는 역할 + 테스트 결과 데이터를 노션에 문서화 하는 역할 + 성능 개선 전략을 작성하는 역할로 나누었다.  

## 3. 테스트 결과
&nbsp; &nbsp; 이후 테스트 시나리오를 추가해서 여러 api에 대해 테스트를 수행했는데, 시간 문제 상 과학실험 하듯이 팀원끼리 역할을 나눠야 했다. jmeter를 직접 작동하는 역할 + 테스트 결과 데이터를 노션에 문서화 하는 역할 + 성능 개선 전략을 작성하는 역할로 나누었다.  

## 4. 성능 개선 전략
&nbsp; &nbsp; 부하 테스트를 진행했더니 성능을 개선하는 방법이 api마다 여러가지가 있었다. 먼저 api 상에서 불필요한 정보를 제공하지 않는 것이었다. 다음으로 비즈니스 로직 상 중복되는 부분을 제거해서 쿼리의 횟수를 줄이는 것이었다. 사실 이런 기초작업들이 성능 개선에 매우 큰 역할을 했다. 다음으로는 인덱스 작업, 페이지네이션, 캐싱처리였다. 
&nbsp; &nbsp; 인덱스 추가는 주의해야 할 것이, 실제로 쿼리가 인덱스를 타고 검색하는지 쿼리 플랜으로 확인해야한다는 것을 알았다. where 절에 like % xx % 구문으로 인덱스를 적용한 컬럼을 조회하면 인덱스를 타지 않기 때문이다.
&nbsp; &nbsp; 페이지네이션 역시 주의해야 할 점이 있었다. -ToMany 연관관계에서 fetch join 이후 페이지네이션을 하면, 정상적으로 작동하지 않았다. 쿼리에 distinct 를 추가해서 페이지네이션이 의도대로 작동하도록 해야했다.